

\paragraph{Syntax.} 
%
To accomodate the new type connective~$\tau + \tau$, we extend our
previous syntantic forms for H-Types, H-Expressions, Actions, Z-Types
and Z-Expressions.
%
In particular,
in H-Types, Shapes and Z-Types, we include syntax for the type connective.
%
In H-Expressions, Shapes and Z-Expressions, we include term syntax
for the type's introduction and elimination forms, injection and case
analysis, respectively.



\begin{figure}
{
%\small
Extensions to \textbf{Syntax} for Sum Types:
%\\[2mm]
\begin{grammar}
\textsf{HTyp} & $\htau$ & \bnfas & $\cdots \bnfalt \tsum{\htau}{\htau}$
\\
\textsf{HExp} & $\hexp$ & \bnfas & $\cdots 
\bnfalt \hinj{i}{\hexp}
\bnfalt \hcase{\hexp}{x}{\hexp}{y}{\hexp}$
\\
\textsf{ZTyp} & $\ztau$ & \bnfas & $\cdots \bnfalt \tsum{\ztau}{\htau} \bnfalt \tsum{\htau}{\ztau}$
\\
\textsf{ZExp} & $\zexp$ & \bnfas & $\cdots
\bnfalt \hinj{i}{\zexp}
\bnfalt \hcase{\zexp}{x}{\hexp}{y}{\hexp}$
\\
&& $\bnfalt$ & $\hcase{\hexp}{x}{\zexp}{y}{\hexp}
\bnfalt\hcase{\hexp}{x}{\hexp}{y}{\zexp}$
\\
\textsf{Shape} & $\varphi$ & \bnfas & $\cdots \bnfalt \fsum \bnfalt \finj{i} \bnfalt \fcase{x}{y}$
\end{grammar}
%\\[2mm]
Extensions to \textbf{Static Semantics} for Sum Types:
\\[1mm]
\judgbox{\sumhasmatched{\htau}{\htau_1+\htau_2}}{$\htau$ has matched $\htau_1+\htau_2$}
\begin{mathpar}
\Infer{}{ }
{\sumhasmatched{\hehole}{\hehole + \hehole}}
\and
\Infer{}{ }
{\sumhasmatched{\htau_1 + \htau_2}{\htau_1 + \htau_2}}
\end{mathpar}

\judgbox{\tcompat{\htau_1}{\htau_2}}{(Additional compatibility form:)}
\begin{mathpar}
  \Infer{}{
    \tcompat{\htau_1}{\htau_1'} 
    \\
    \tcompat{\htau_2}{\htau_2'}
    }
   {\tcompat{\htau_1 + \htau_2}{\htau_1' + \htau_2'}}
\end{mathpar}

\judgbox{\hana{\hGamma}{\hexp}{\htau}}{(Additional analytical typing forms:)}
\begin{mathpar}
\Infer{Inj$_i$}
{ \hana{ \hGamma }{ \hexp }{ \htau_i }~~(i\in\{1,2\})
  \\
  \sumhasmatched{\htau_{+}}{\htau_1 + \htau_2}
}
{ \hana{ \hGamma }{ \hinj{i}{\hexp} }{ \htau_{+} } }
\and
\Infer{Case}
{ \hsyn{ \hGamma }{ \hexp }{ \htau_{+} }
  \\
  \sumhasmatched{\htau_{+}}{\tsum{\htau_1}{\htau_2}}
  \\
  \hana{ \hGamma, x:\htau_1 }{ \hexp_1 }{ \htau }
  \\
  \hana{ \hGamma, y:\htau_2 }{ \hexp_2 }{ \htau }
}
{ \hana{ \hGamma }{ \hcase{\hexp}{x}{\hexp_1}{y}{\hexp_2} }{ \htau } }
\end{mathpar}
\\[1mm]
Extensions to \textbf{Action Semantics} for Sum Types:
\\[1mm]
\judgbox{\performTyp{\ztau}{\alpha}{\ztau}}{(Additional type construction action:)}
\begin{mathpar}
  \Infer{}{ }
{
  \performTyp{\zwsel{\htau}}{\aConstruct{\fsum}}
             {\tsum{{\htau}}{\zwsel{\hehole}}}
}
\end{mathpar}

\judgbox{\performAna{\hGamma}{\zexp}{\htau}{\alpha}{\zexp'}}
{(Additional analytical actions:)}
\begin{mathpar}
  \Infer{}{ \sumhasmatched{\htau}{\tsum{\hehole}{\hehole}} }
  {
  \performAna{\hGamma}{\zwsel{\hehole}}
              {\htau_{+}}
              {\aConstruct{\finj{i}}}
              {\hinj{i}{\zwsel{\hehole}}}
  }
  \and
  \Infer{}{ \tincompat{\htau}{ \tsum{\hehole}{\hehole} } }
        {
  \performAna{\hGamma}{\zwsel{\hehole}}
              {\htau}
              {\aConstruct{\finj{i}}}
              {\hhole{
                  \hinj{i}{\hehole}                  
                  : \zwsel{\hehole} + \hehole
              }}              
        }
  \and
  \Infer{}{ }{
  \performAna{\hGamma}{\zwsel{\hehole}}
              {\htau}
              {\aConstruct{\fcase{x}{y}}}
              {\hcase{\zwsel{\hehole}}{x}{\hehole}{y}{\hehole}}
  }
\and
%% Inj -- Editing injected expression
\Infer{}
{
  \performAna{\hGamma}{\zexp}{\htau_i}{\alpha}{\zexp'}~~(i\in\{1,2\})
  \\
  \sumhasmatched{\htau_{+}}{\htau_1+\htau_2}
}{
  \performAna
  {\hGamma}
  {\hinj{i}{\zexp }}
  {\htau_{+}}
  {\alpha}
  {\hinj{i}{\zexp' }}
}
\and
%% Case -- Editing scrutinee
\Infer{}
{
  \hsyn
  {\hGamma}
  {\removeSel{\zexp}}
  {\htau_0}  
  \\
  \performSyn
  {\hGamma}
  {\zexp}
  {\htau_0}
  {\alpha}
  {\zexp'}
  {\htau_{+}}
  \\
  \sumhasmatched{\htau_{+}}{\htau_1 + \htau_2}
  \\\\
  \hana{\hGamma, x:\htau_1}{\hexp_1}{\htau}
  \\
  \hana{\hGamma, y:\htau_2}{\hexp_2}{\htau}
}{
  \performAna
  {\hGamma}
  {\hcase{\zexp }{x}{\hexp_1}{y}{\hexp_2}}
  {\htau}
  {\alpha}
  {\hcase{\zexp'}{x}{\hexp_1}{y}{\hexp_2}}
}
\and
%% Case -- Editing first branch arm
\Infer{}
{
  \hsyn{\hGamma}{\hexp}{\htau_{+}}
  \\
  \sumhasmatched{\htau_{+}}{\htau_1 + \htau_2}
  \\\\
  \performAna{\hGamma, x:\htau_1}{\zexp_1}{\htau}{\alpha}{\zexp_1'}
  \\
  \hana{\hGamma, y:\htau_2}{\hexp_2}{\htau}
}{
  \performAna
  {\hGamma}
  {\hcase{\hexp}{x}{\zexp_1}{y}{\hexp_2}}
  {\htau}
  {\alpha}
  {\hcase{\hexp}{x}{\zexp_1'}{y}{\hexp_2}}
}
\and
%% Case -- Editing second branch arm
\Infer{}
{
  \hsyn{\hGamma}{\hexp}{\htau_{+}}
  \\
  \sumhasmatched{\htau_{+}}{\htau_1 + \htau_2}
  \\\\
  \hana{\hGamma, x:\htau_1}{\hexp_1}{\htau}
  \\
  \performAna{\hGamma, y:\htau_2}{\zexp_2}{\htau}{\alpha}{\zexp_2'}
}{
  \performAna
  {\hGamma}
  {\hcase{\hexp}{x}{\hexp_1}{y}{\zexp_2}}
  {\htau}
  {\alpha}
  {\hcase{\hexp}{x}{\hexp_1}{y}{\zexp_2'}}
}

\end{mathpar}
}
\caption{Hazelnut extensions for sum types: Syntax (top), Statics (middle) and Editing (bottom).}
\end{figure}

\begin{figure}
\judgbox{\performMove{\zexp}{\aMove{\delta}}{\zexp'}}{(Additional movement-action rules:)}
\begin{displaymath}
\begin{array}{@{}rcl}
  %\multicolumn{3}{l}{\textbf{Movement Actions for Sum Type Forms}:}
  %\\
  \TABperformMove
      {\zwsel{\tsum{\htau_1}{\htau_2}}}
      {\aMove{\dChild}}
      {      {\tsum{\zwsel{\htau_1}}{\htau_2}}}
  \\
  \TABperformMove
      {      {\tsum{\zwsel{\htau_1}}{\htau_2}}}
      {\aMove{\dNext}}
      {      {\tsum{{\htau_1}}{\zwsel{\htau_2}}}}
  \\
  \TABperformMove
      {      {\tsum{{\htau_1}}{\zwsel{\htau_2}}}}
      {\aMove{\dPrev}}
      {      {\tsum{\zwsel{\htau_1}}{\htau_2}}}
  \\
  \TABperformMove
      {      {\tsum{\zwsel{\htau_1}}{\htau_2}}}
      {\aMove{\dParent}}
      {\zwsel{\tsum{{\htau_1}}{{\htau_2}}}}
  \\
  \TABperformMove
      {      {\tsum{{\htau_1}}{{\zwsel{\htau_2}}}}}
      {\aMove{\dParent}}
      {\zwsel{\tsum{{\htau_1}}{\htau_2}}}
  \\[2mm]
  \TABperformMove
      {\zwsel{\hinj{i}{\hexp}}}
      {\aMove{\dChild}}
      {\hinj{i}{\zwsel{\hexp}}}      
  \\
  \TABperformMove
      {\hinj{i}{\zwsel{\hexp}}}      
      {\aMove{\dParent}}
      {\zwsel{\hinj{i}{\hexp}}}
  \\[2mm]
  \TABperformMove
      {\zwsel{\hcase{\hexp}{x}{\hexp_1}{y}{\hexp_2}}}
      {\aMove{\dChild}}
      {      {\hcase{\zwsel{\hexp}}{x}{\hexp_1}{y}{\hexp_2}}}
  \\
  \TABperformMove
      {      {\hcase{\zwsel{\hexp}}{x}{\hexp_1}{y}{\hexp_2}}}
      {\aMove{\dNext}}
      {      {\hcase{{\hexp}}{x}{\zwsel{\hexp_1}}{y}{\hexp_2}}}
  \\
  \TABperformMove
      {      {\hcase{{\hexp}}{x}{\zwsel{\hexp_1}}{y}{\hexp_2}}}
      {\aMove{\dNext}}
      {      {\hcase{{\hexp}}{x}{{\hexp_1}}{y}{\zwsel{\hexp_2}}}}
  \\
  \TABperformMove
      {      {\hcase{{\hexp}}{x}{{\hexp_1}}{y}{\zwsel{\hexp_2}}}}
      {\aMove{\dPrev}}
      {      {\hcase{{\hexp}}{x}{\zwsel{\hexp_1}}{y}{\hexp_2}}}
  \\
  \TABperformMove
      {      {\hcase{{\hexp}}{x}{\zwsel{\hexp_1}}{y}{\hexp_2}}}
      {\aMove{\dPrev}}
      {      {\hcase{{\zwsel{\hexp}}}{x}{{\hexp_1}}{y}{{\hexp_2}}}}
  \\
  \TABperformMove
      {      {\hcase{\zwsel{\hexp}}{x}{\hexp_1}{y}{\hexp_2}}}
      {\aMove{\dParent}}
      {\zwsel{\hcase{{\hexp}}{x}{\hexp_1}{y}{\hexp_2}}}
  \\
  \TABperformMove
      {      {\hcase{{\hexp}}{x}{\zwsel{\hexp_1}}{y}{\hexp_2}}}
      {\aMove{\dParent}}
      {\zwsel{\hcase{{\hexp}}{x}{\hexp_1}{y}{\hexp_2}}}
  \\
  \TABperformMove
      {      {\hcase{{\hexp}}{x}{\hexp_1}{y}{\zwsel{\hexp_2}}}}
      {\aMove{\dParent}}
      {\zwsel{\hcase{{\hexp}}{x}{\hexp_1}{y}{\hexp_2}}}
\end{array}
\end{displaymath}
\caption{Movement action semantics for sum type forms.}
\end{figure}


\iffalse
\begin{displaymath}
\begin{array}{@{}r@{~}l@{~~~}c@{~~~}ll@{~~}}
  %\hline
  \multicolumn{5}{l}{\textbf{Type Construction Actions for Sum Type}:}
  \\
  %\hline
  %\hline
  %&\textbf{Pre} & \texttt{cons}. & \textbf{Post} & \textbf{Term type}
  %\\
  \TABperformTyp{\zwsel{\hehole}}{\aConstructx{\fsum}}
  {\tsum{\zwsel{\hehole}}{\hehole}}
  \\[3mm]
  %\hline
  \multicolumn{5}{l}{\textbf{Analytical Construction Actions for Sum Type}:}
  \\
  %\hline
  \TABperformAna{\hGamma}{\zwsel{\hehole}}
              {\tsum{\hehole}{\hehole}}
              {\aConstructx{\finj{i}}}
              {\hinj{i}{\zwsel{\hehole}}}
  \\
  \TABperformAna{\hGamma}{\zwsel{\hehole}}
              {\htau, \tincompat{\htau}{ \tsum{\hehole}{\hehole} }}
              {\aConstructx{\finj{i}}}
              {\hhole{\hinj{i}{\zwsel{\hehole}}}}
  \\
  \TABperformAna{\hGamma}{\zwsel{\hehole}}
              {\htau}
              {\aConstructx{\fcase{x}{y}}}
              {\hcase{\zwsel{\hehole}}{x}{\hehole}{y}{\hehole}}
  %\\[3mm]
  %\multicolumn{5}{l}{\textbf{Synthetic Construction Actions for $+$ Type}:}
  %\\
  %\multicolumn{5}{l}{\textit{none}}
  %\\[3mm]

  %\\[3mm]
  %\multicolumn{5}{l}{\textbf{Synthetic Construction Actions for $+$ Type}:}
\end{array}
\end{displaymath}
\fi
