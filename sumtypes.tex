
\newcommand{\TABperformAna}[5]{#1 \vdash & #2                & \xlongrightarrow{#4} & #5 & \Leftarrow #3}
\newcommand{\TABperformSyn}[6]{#1 \vdash & #2 \Rightarrow #3 & \xlongrightarrow{#4} & #5 \Rightarrow #6}
\newcommand{\TABperformTyp}[3]{& #1 & \xlongrightarrow{#2} & #3}

\newcommand{\TABperformMove}[3]{#1 & \xlongrightarrow{#2} & #3}
\newcommand{\TABperformDel}[2]{#1 \xlongrightarrow{\aDel} #2}

\paragraph{Syntax.} 
%
To accomodate the new type connective~$\tau + \tau$, we extend our
previous syntantic forms for H-Types, H-Expressions, Actions, Z-Types
and Z-Expressions.
%
In particular,
in H-Types, Shapes and Z-Types, we include syntax for the type connective.
%
In H-Expressions, Shapes and Z-Expressions, we include term syntax
for the type's introduction and elimination forms, injection and case
analysis, respectively.

\textbf{Syntactic Extensions for Sum Type:}
\begin{grammar}
\textsf{HTyp} & $\htau$ & \bnfas & $\cdots \bnfalt \tsum{\htau}{\htau}$
\\
\textsf{HExp} & $\hexp$ & \bnfas & $\cdots 
\bnfalt \hinj{i}{\hexp}
\bnfalt \hcase{\hexp}{x}{\hexp}{y}{\hexp}$
\\
\textsf{Shape} & $\varphi$ & \bnfas & $\cdots \bnfalt \fsum \bnfalt \finj{i} \bnfalt \fcase{x}{y}$
\\[3mm]
\textsf{ZTyp} & $\ztau$ & \bnfas & $\cdots \bnfalt \tsum{\ztau}{\htau} \bnfalt \tsum{\htau}{\ztau}$
\\
\textsf{ZExp} & $\zexp$ & \bnfas & $\cdots
\bnfalt \hinj{i}{\zexp}
\bnfalt \hcase{\zexp}{x}{\hexp}{y}{\hexp}
$
\\
&&& $
\bnfaltbrk \hcase{\hexp}{x}{\zexp}{y}{\hexp}
\bnfalt    \hcase{\hexp}{x}{\hexp}{y}{\zexp}$
\end{grammar}

\textbf{Static Semantics of Sum Type:}
\begin{mathpar}
\Infer{Inj$_1$}
{ \hana{ \hGamma }{ \hexp }{ \htau_1 } }
{ \hana{ \hGamma }{ \hinj{1}{\hexp} }{ \tsum{\htau_1}{\htau_2} } }
\and
\Infer{Inj$_2$}
{ \hana{ \hGamma }{ \hexp }{ \htau_2 } }
{ \hana{ \hGamma }{ \hinj{2}{\hexp} }{ \tsum{\htau_1}{\htau_2} } }
\and
\Infer{Case}
{ \hsyn{ \hGamma }{ \hexp }{ \tsum{\htau_1}{\htau_2} }
  \\
  \hana{ \hGamma, x:\htau_1 }{ \hexp_1 }{ \htau }
  \\
  \hana{ \hGamma, y:\htau_2 }{ \hexp_2 }{ \htau }
}
{ \hana{ \hGamma }{ \hcase{\hexp}{x}{\hexp_1}{y}{\hexp_2} }{ \htau } }
\and
\Infer{Case-H}
{ \hsyn{ \hGamma }{ \hexp }{ \hehole }
  \\
  \hana{ \hGamma, x:\hehole }{ \hexp_1 }{ \htau }
  \\
  \hana{ \hGamma, y:\hehole }{ \hexp_2 }{ \htau }
}
{ \hana{ \hGamma }{ \hcase{\hexp}{x}{\hexp_1}{y}{\hexp_2} }{ \htau } }
\end{mathpar}

\begin{figure}
{
\small
\begin{displaymath}
\begin{array}{@{}r@{~}l@{~~~}c@{~~~}ll@{~~}}
  %\hline
  \multicolumn{5}{l}{\textbf{Type Construction Actions for Sum Type}:}
  \\
  %\hline
  %\hline
  %&\textbf{Pre} & \texttt{cons}. & \textbf{Post} & \textbf{Term type}
  %\\
  \TABperformTyp{\zwsel{\hehole}}{\aConstructx{\fsum}}
  {\tsum{\zwsel{\hehole}}{\hehole}}
  \\[3mm]
  %\hline
  \multicolumn{5}{l}{\textbf{Analytical Construction Actions for Sum Type}:}
  \\
  %\hline
  \TABperformAna{\hGamma}{\zwsel{\hehole}}
              {\tsum{\hehole}{\hehole}}
              {\aConstructx{\finj{i}}}
              {\hinj{i}{\zwsel{\hehole}}}
  \\
  \TABperformAna{\hGamma}{\zwsel{\hehole}}
              {\htau, \tincompat{\htau}{ \tsum{\hehole}{\hehole} }}
              {\aConstructx{\finj{i}}}
              {\hhole{\hinj{i}{\zwsel{\hehole}}}}
  \\
  \TABperformAna{\hGamma}{\zwsel{\hehole}}
              {\htau}
              {\aConstructx{\fcase{x}{y}}}
              {\hcase{\zwsel{\hehole}}{x}{\hehole}{y}{\hehole}}
  %\\[3mm]
  %\multicolumn{5}{l}{\textbf{Synthetic Construction Actions for $+$ Type}:}
  %\\
  %\multicolumn{5}{l}{\textit{none}}
  %\\[3mm]

  %\\[3mm]
  %\multicolumn{5}{l}{\textbf{Synthetic Construction Actions for $+$ Type}:}
\end{array}
\end{displaymath}
\\[-2mm]
\begin{displaymath}
\begin{array}{@{}rcl}
  \multicolumn{3}{l}{\textbf{Movement Actions for Sum Type Forms}:}
  \\
  \TABperformMove
      {\zwsel{\tsum{\htau_1}{\htau_2}}}
      {\aMove{\dChild}}
      {      {\tsum{\zwsel{\htau_1}}{\htau_2}}}
  \\
  \TABperformMove
      {      {\tsum{\zwsel{\htau_1}}{\htau_2}}}
      {\aMove{\dNext}}
      {      {\tsum{{\htau_1}}{\zwsel{\htau_2}}}}
  \\
  \TABperformMove
      {      {\tsum{{\htau_1}}{\zwsel{\htau_2}}}}
      {\aMove{\dPrev}}
      {      {\tsum{\zwsel{\htau_1}}{\htau_2}}}
  \\
  \TABperformMove
      {      {\tsum{\zwsel{\htau_1}}{\htau_2}}}
      {\aMove{\dParent}}
      {\zwsel{\tsum{{\htau_1}}{{\htau_2}}}}
  \\
  \TABperformMove
      {      {\tsum{{\htau_1}}{{\zwsel{\htau_2}}}}}
      {\aMove{\dParent}}
      {\zwsel{\tsum{{\htau_1}}{\htau_2}}}
  \\[2mm]
  \TABperformMove
      {\zwsel{\hinj{i}{\hexp}}}
      {\aMove{\dChild}}
      {\hinj{i}{\zwsel{\hexp}}}      
  \\
  \TABperformMove
      {\hinj{i}{\zwsel{\hexp}}}      
      {\aMove{\dParent}}
      {\zwsel{\hinj{i}{\hexp}}}
  \\[2mm]
  \TABperformMove
      {\zwsel{\hcase{\hexp}{x}{\hexp_1}{y}{\hexp_2}}}
      {\aMove{\dChild}}
      {      {\hcase{\zwsel{\hexp}}{x}{\hexp_1}{y}{\hexp_2}}}
  \\
  \TABperformMove
      {      {\hcase{\zwsel{\hexp}}{x}{\hexp_1}{y}{\hexp_2}}}
      {\aMove{\dNext}}
      {      {\hcase{{\hexp}}{x}{\zwsel{\hexp_1}}{y}{\hexp_2}}}
  \\
  \TABperformMove
      {      {\hcase{{\hexp}}{x}{\zwsel{\hexp_1}}{y}{\hexp_2}}}
      {\aMove{\dNext}}
      {      {\hcase{{\hexp}}{x}{{\hexp_1}}{y}{\zwsel{\hexp_2}}}}
  \\
  \TABperformMove
      {      {\hcase{{\hexp}}{x}{{\hexp_1}}{y}{\zwsel{\hexp_2}}}}
      {\aMove{\dPrev}}
      {      {\hcase{{\hexp}}{x}{\zwsel{\hexp_1}}{y}{\hexp_2}}}
  \\
  \TABperformMove
      {      {\hcase{{\hexp}}{x}{\zwsel{\hexp_1}}{y}{\hexp_2}}}
      {\aMove{\dPrev}}
      {      {\hcase{{\zwsel{\hexp}}}{x}{{\hexp_1}}{y}{{\hexp_2}}}}
  \\
  \TABperformMove
      {      {\hcase{\zwsel{\hexp}}{x}{\hexp_1}{y}{\hexp_2}}}
      {\aMove{\dParent}}
      {\zwsel{\hcase{{\hexp}}{x}{\hexp_1}{y}{\hexp_2}}}
  \\
  \TABperformMove
      {      {\hcase{{\hexp}}{x}{\zwsel{\hexp_1}}{y}{\hexp_2}}}
      {\aMove{\dParent}}
      {\zwsel{\hcase{{\hexp}}{x}{\hexp_1}{y}{\hexp_2}}}
  \\
  \TABperformMove
      {      {\hcase{{\hexp}}{x}{\hexp_1}{y}{\zwsel{\hexp_2}}}}
      {\aMove{\dParent}}
      {\zwsel{\hcase{{\hexp}}{x}{\hexp_1}{y}{\hexp_2}}}
\end{array}
\end{displaymath}
\\[2mm]
\textbf{Action Semantics for Zipper Structure:}
\begin{mathpar}
\noindent
\Infer{}
{
  \performAna{\hGamma}{\zexp}{\htau_1}{\alpha}{\zexp'}
}{
  \performAna
  {\hGamma}
  {\hinj{1}{\zexp }}
  {\htau_1 + \htau_2}
  {\alpha}
  {\hinj{1}{\zexp' }}
}
\and
\Infer{}
{
  \performAna{\hGamma}{\zexp}{\htau_2}{\alpha}{\zexp'}
}{
  \performAna
  {\hGamma}
  {\hinj{2}{\zexp }}
  {\htau_1 + \htau_2}
  {\alpha}
  {\hinj{2}{\zexp' }}
}
\and
\Infer{}
{
  \hsyn
  {\hGamma}
  {\removeSel{\zexp}}
  {\htau_0}  
  \\
  \performSyn
  {\hGamma}
  {\zexp}
  {\htau_0}
  {\alpha}
  {\zexp'}
  {\htau_1 + \htau_2}
  \\\\
  \hana{\hGamma, x:\htau_1}{\hexp_1}{\htau}
  \\
  \hana{\hGamma, y:\htau_2}{\hexp_2}{\htau}
}{
  \performAna
  {\hGamma}
  {\hcase{\zexp }{x}{\hexp_1}{y}{\hexp_2}}
  {\htau}
  {\alpha}
  {\hcase{\zexp'}{x}{\hexp_1}{y}{\hexp_2}}
}
\and
\Infer{}
{
  \hsyn
  {\hGamma}
  {\removeSel{\zexp}}
  {\htau_0}  
  \\
  \performSyn
  {\hGamma}
  {\zexp}
  {\htau_0}
  {\alpha}
  {\zexp'}
  {\hehole}
  \\\\
  \hana{\hGamma, x:\hehole}{\hexp_1}{\htau}
  \\
  \hana{\hGamma, y:\hehole}{\hexp_2}{\htau}
}{
  \performAna
  {\hGamma}
  {\hcase{\zexp }{x}{\hexp_1}{y}{\hexp_2}}
  {\htau}
  {\alpha}
  {\hcase{\zexp'}{x}{\hexp_1}{y}{\hexp_2}}
}
%
\and
\Infer{}
{
  \hsyn
  {\hGamma}
  {\hexp}
  {\htau_1 + \htau_2}
  \\\\
  \performAna
  {\hGamma, x:\htau_1}
  {\zexp_1}
  {\htau}
  {\alpha}
  {\zexp_1'}
  \\
  \hana{\hGamma, y:\htau_2}{\hexp_2}{\htau}
}{
  \performAna
  {\hGamma}
  {\hcase{\hexp }{x}{\zexp_1}{y}{\hexp_2}}
  {\htau}
  {\alpha}
  {\hcase{\hexp}{x}{\zexp_1'}{y}{\hexp_2}}
}
\and
\Infer{}
{
  \hsyn
  {\hGamma}
  {\hexp}
  {\hehole}
  \\\\
  \performAna
  {\hGamma, x:\hehole}
  {\zexp_1}
  {\htau}
  {\alpha}
  {\zexp_1'}
  \\
  \hana{\hGamma, y:\htau_2}{\hexp_2}{\htau}
}{
  \performAna
  {\hGamma}
  {\hcase{\hexp }{x}{\zexp_1}{y}{\hexp_2}}
  {\htau}
  {\alpha}
  {\hcase{\hexp}{x}{\zexp_1'}{y}{\hexp_2}}
}
%
\and
\Infer{}
{
  \hsyn
  {\hGamma}
  {\hexp}
  {\htau_1 + \htau_2}
  \\\\
  \hana{\hGamma, x:\htau_1}{\hexp_1}{\htau}
  \\
  \performAna
  {\hGamma, y:\htau_2}
  {\zexp_2}
  {\htau}
  {\alpha}
  {\zexp_2'}
}{
  \performAna
  {\hGamma}
  {\hcase{\hexp }{x}{\hexp_1}{y}{\zexp_2}}
  {\htau}
  {\alpha}
  {\hcase{\hexp}{x}{\hexp_1}{y}{\zexp_2'}}
}
%
\and
\Infer{}
{
  \hsyn
  {\hGamma}
  {\hexp}
  {\hehole}
  \\\\
  \hana{\hGamma, x:\htau_1}{\hexp_1}{\htau}
  \\
  \performAna
  {\hGamma, y:\hehole}
  {\zexp_2}
  {\htau}
  {\alpha}
  {\zexp_2'}
}{
  \performAna
  {\hGamma}
  {\hcase{\hexp }{x}{\hexp_1}{y}{\zexp_2}}
  {\htau}
  {\alpha}
  {\hcase{\hexp}{x}{\hexp_1}{y}{\zexp_2'}}
}

\end{mathpar}
}
\caption{Hazelnut action semantics for sum type extension.}
\end{figure}
